<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="Anwendung zur Anzeige der taktischen Zeit basierend auf lokaler Zeit. Script erstellt f√ºr THW Ortsverband Bad Bergzabern." />
<meta name="keywords" content="thw, taktisch, zeit, uhr, utc, bad bergzabern, ov, zeitanzeige, einsatzzeit" />
<meta name="author" content="Wolfgang Saal, B√∂llenborn" />

<!-- PWA + Theming -->
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#000F75">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000F75">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Taktische Zeit">
<link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Crect width='512' height='512' rx='90' fill='%23000F75'/%3E%3Ctext x='50%' y='58%' font-size='260' text-anchor='middle' fill='%23B3FFFF' font-family='Arial,Helvetica,sans-serif'%3ETZ%3C/text%3E%3C/svg%3E">
<link id="dynamic-manifest" rel="manifest">

<title>Taktische Zeit</title>

<style>
  :root {
    --bg-color: #000F75;
    --text-color: #222;
    --card-bg: #d5d5d5; 
    --label-color: #777;
    --highlight-bg: #B3FFFF;
    --shadow: rgba(0, 0, 0, 0.1);

    --color-tag: #1e3a8a;
    --color-zeit: #16a34a;
    --color-monat: #d97706;
    --color-jahr: #b91c1c;

    --font-size-label: clamp(0.75rem, 1vw + 0.3rem, 0.95rem);
    --font-size-value: clamp(1.5rem, 4vw + 0.5rem, 3.5rem);
    --font-size-value-utc: clamp(0.9rem, 1.5vw + 0.3rem, 1.3rem);
    --font-size-taktisch-zeit: clamp(2rem, 5vw + 0.5rem, 4rem);
    --font-size-dark-toggle: clamp(0.7rem, 1vw + 0.4rem, 1rem);
  }

  /* Dark-Mode Variablen */
  body.dark {
    --bg-color: #000F75;
    --text-color: #eee;
    --card-bg: #1e1e1e;
    --label-color: #aaa;
    --highlight-bg: #003399;
    --shadow: rgba(0, 0, 0, 0.5);

    --color-tag: #93c5fd;
    --color-zeit: #86efac;
    --color-monat: #fcd34d;
    --color-jahr: #f87171;
  }

  body {
    margin: 0;
    font-family: 'Segoe UI', Roboto, sans-serif;
    background: var(--bg-color);
    color: var(--text-color);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    min-height: 100dvh;
    padding: 20px;
    transition: background 0.3s, color 0.3s;
  }

  .top-bar {
    width: 100%;
    display: flex;
    justify-content: flex-end;
    max-width: 900px;
    align-items: center;
    gap: 10px;
  }

  button.toggle-button {
    cursor: pointer;
    font-size: var(--font-size-dark-toggle);
    background: none;
    border: none;
    color: #E3E3E3;
    padding: 8px 12px;
    border-radius: 6px;
    transition: background 0.3s;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    min-width: 44px; min-height: 44px;
  }
  button.toggle-button:hover { background: rgba(255,165,0,0.5); }
  .toggle-button .icon { display: inline-block; line-height: 1; }
  .toggle-button .btn-text { white-space: nowrap; }

  .container {
    background: var(--card-bg);
    border-radius: 12px;
    box-shadow: 0 4px 20px var(--shadow);
    padding: clamp(15px, 2vw + 10px, 40px);
    max-width: 900px;
    width: 100%;
    text-align: center;
    transition: background 0.3s, box-shadow 0.3s;
  }

  .site-footer { text-align: center; padding: 1rem; font-size: 0.9rem; color: #777; background: transparent; }

  /* Grundlayout der Items (Stack) */
  .items { display: grid; gap: 18px; }
  .item  { display: grid; gap: 6px; align-items: baseline; justify-items: center; }
  .label { font-size: var(--font-size-label); color: var(--label-color); }
  .value { font-size: var(--font-size-value); font-weight: bold; color: var(--text-color); }

  .value.utc { color: #888; font-size: var(--font-size-value-utc); display: none; }
  .value.utc.visible { display: block; }

  .taktisch-box { background: var(--highlight-bg); color: var(--text-color); padding: 20px; border-radius: 10px; margin-top: 24px; box-shadow: 0 2px 10px var(--shadow); }
  .taktisch-label { font-size: var(--font-size-label); color: var(--label-color); margin-bottom: 10px; }
  .taktisch-label h2 { margin: 0; }

  .taktisch-zeit {
    font-size: var(--font-size-taktisch-zeit);
    font-weight: bold;
    letter-spacing: 1px;
    display: flex; flex-wrap: wrap; justify-content: center; gap: 10px;
  }
  @media (min-width: 800px){ .taktisch-zeit { flex-wrap: nowrap; } }

  .taktisch-tag { color: var(--color-tag); }
  .taktisch-zeitteil { color: var(--color-zeit); }
  .taktisch-monat { color: var(--color-monat); text-transform: uppercase; }
  .taktisch-jahr { color: var(--color-jahr); }

  /* ‚â§600px: Buttons als Icons (sichtbar), Footer weg */
  @media (max-width: 600px) {
    .top-bar { gap: 8px; }
    button.toggle-button {
      width: 44px; min-width: 44px; height: 44px; padding: 0;
      border-radius: 9999px; justify-content: center; gap: 0;
    }
    .toggle-button .btn-text { display: none; }  /* Nur Text ausblenden */
    .toggle-button .icon { margin: 0; }          /* Emoji bleibt */
    .site-footer { display: none !important; }
  }

  /* ====== LANDSCAPE-OPTIMIERUNG (wenig H√∂he) ====== */
  /* 1) Mittlere Schranke: Inline-Labels + einzeilige Items (schont H√∂he) */
  @media (orientation: landscape) and (max-height: 520px) {
    body { padding: 10px; }
    .container { padding: 10px 12px; }
    .items { 
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px 16px;
    }
    .item {
      display: inline-flex;
      align-items: baseline;
      gap: 6px;
      margin: 0;
    }
    .label { 
      display: inline; 
      margin: 0; 
    }
    .value { 
      display: inline; 
      font-variant-numeric: tabular-nums;
      line-height: 1.15;
    }
    .site-footer { display: none !important; }
    .top-bar .btn-text { display: none !important; }
    .taktisch-box { margin-top: 12px; padding: 10px; }
  }

  /* 2) Enge Schranke: Labels ganz ausblenden, nur Werte (maximal kompakt) */
  @media (orientation: landscape) and (max-height: 420px) {
    .label { display: none !important; }
    .items { gap: 8px 14px; }
    .item { gap: 4px; }
    .container { padding: 8px; }
  }

  /* 3) Falls extrem wenig Platz: noch kleinere Font-Skalierung */
  @media (orientation: landscape) and (max-height: 360px) {
    :root{
      --font-size-value: clamp(1rem, calc(var(--vpmin) / 18), 2.5rem);
      --font-size-value-utc: clamp(0.8rem, calc(var(--vpmin) / 26), 1.2rem);
      --font-size-taktisch-zeit: clamp(1.2rem, calc(var(--vpmin) / 12), 3rem);
      --font-size-label: clamp(0.65rem, calc(var(--vpmin) / 48), 0.85rem);
    }
    .taktisch-box { margin-top: 8px; }
  }

  /* ====== PORTRAIT-OPTIMIERUNG ====== */
  @media (orientation: portrait) and (max-width: 900px) {
    .top-bar .btn-text { display: none !important; }
    .site-footer { display: none !important; }
  }

  /* ====== FLUID SCALING (kleinere Kante) ====== */
  :root{ --vpmin: min(100vw, 100dvh); }
  :root{
    --font-size-value: clamp(1.2rem, calc(var(--vpmin) / 16), 3.4rem);
    --font-size-value-utc: clamp(0.9rem, calc(var(--vpmin) / 24), 1.3rem);
    --font-size-taktisch-zeit: clamp(1.6rem, calc(var(--vpmin) / 10.5), 4.2rem);
    --font-size-label: clamp(0.75rem, calc(var(--vpmin) / 42), 0.95rem);
  }

</style>
</head>

<body>
  <div class="top-bar">
    <button class="toggle-button" id="darkModeBtn" onclick="toggleDarkMode()" aria-label="Dunkler Modus umschalten" title="Dunkler Modus">
      <span class="icon" aria-hidden="true">üåô</span><span class="btn-text">Dunkler Modus</span>
    </button>
    <button class="toggle-button" id="utcToggleBtn" onclick="toggleUtcVisibility()" aria-label="UTC-Zeit ein/ausblenden" title="UTC-Zeit">
      <span class="icon" aria-hidden="true">üåê</span><span class="btn-text">UTC Zeit</span>
    </button>
  </div>

  <div class="container">
    <!-- flexible Items-Container -->
    <div class="items" id="items">
      <div class="item">
        <div class="label">Heute ist der</div>  
        <div class="value" id="datum" aria-label="Datum"></div>
      </div>

      <div class="item">
        <div class="label">Lokale Uhrzeit</div>
        <div class="value" id="uhrzeit" aria-label="Lokale Uhrzeit"></div>
      </div>

      <div class="item" id="utcItem">
        <div class="label">UTC / GMT-Zeit</div>
        <div class="value utc" id="utczeit" aria-label="UTC Zeit"></div>
      </div>
    </div>

    <div class="taktisch-box"> 
      <div class="taktisch-label"><h2>Taktische Zeit</h2></div>
      <div class="taktisch-zeit" id="taktzeit"></div>      
    </div>
  </div>

  <footer class="site-footer" style="text-align:center; font-size: 0.75rem; color:#777; margin-top: 1rem;">
    ¬© 2025 Wolfgang Saal, B√∂llenborn - Version 1.4 - 21.08.2025<br />
    Dieses Projekt ist unter der <a href="https://opensource.org/licenses/MIT" target="_blank">MIT-Lizenz</a> lizenziert. 
    Die Nutzung ist frei, solange der Urheber genannt wird.<br>
    Download unter <a href="https://github.com/wsaal68/taktische-zeit" target="_blank">Github</a>.
  </footer>

<script>
  /* === FLUID SCALING Fallback: setzt --vpmin auf die kleinere Kante in px === */
  (function setVpmin(){
    function apply() {
      var vpmin = Math.min(window.innerWidth, window.innerHeight);
      document.documentElement.style.setProperty('--vpmin', vpmin + 'px');
    }
    apply();
    window.addEventListener('resize', apply);
    window.addEventListener('orientationchange', apply);
    window.addEventListener('load', function(){ setTimeout(apply, 150); });
  })();

  /* ---------- Helpers ---------- */
  const Q = (sel) => document.querySelector(sel);
  function pad(n){ return n < 10 ? '0' + n : '' + n; }
  function getMonthAbbreviation(m){ return ['JAN','FEB','MAR','APR','MAY','JUN','JUL','AUG','SEP','OCT','NOV','DEC'][m]; }

  /* ---------- Zeit / Anzeige ---------- */
  function updateTime(){
    const now = new Date();
    const tag = pad(now.getDate());
    const monat = pad(now.getMonth() + 1);
    const jahr = now.getFullYear();
    const stunde = pad(now.getHours());
    const minute = pad(now.getMinutes());
    const sekunde = pad(now.getSeconds());

    Q('#datum').textContent   = `${tag}.${monat}.${jahr}`;
    Q('#uhrzeit').textContent = `${stunde}:${minute}:${sekunde}`;

    const utcH = pad(now.getUTCHours());
    const utcM = pad(now.getUTCMinutes());
    const utcS = pad(now.getUTCSeconds());
    Q('#utczeit').textContent = `${utcH}:${utcM}:${utcS}`;

    Q('#taktzeit').innerHTML = `
      <span class="taktisch-tag">${tag}</span>
      <span class="taktisch-zeitteil">${stunde}${minute}</span>
      <span class="taktisch-monat">${getMonthAbbreviation(now.getMonth())}</span>
      <span class="taktisch-jahr">${String(jahr).slice(-2)}</span>
    `;
  }

  /* ---------- Dark-Mode / Buttons ---------- */
  function setDark(isDark){
    document.body.classList.toggle('dark', !!isDark);
    localStorage.setItem('darkMode', isDark ? 'true' : 'false');
    updateDarkModeButton();
  }
  function toggleDarkMode(){
    const isDark = !document.body.classList.contains('dark');
    setDark(isDark);
  }
  function updateDarkModeButton(){
    const btn = Q('#darkModeBtn');
    const icon = btn.querySelector('.icon');
    const text = btn.querySelector('.btn-text');
    const isDark = document.body.classList.contains('dark');

    icon.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';           // Emoji immer sichtbar
    text.textContent = isDark ? 'Heller Modus' : 'Dunkler Modus'; // f√ºr gro√üe Screens
  }

  /* ---------- UTC Sichtbarkeit ---------- */
  function toggleUtcVisibility(){
    const utcElem = Q('#utczeit');
    const utcLabel = utcElem ? utcElem.previousElementSibling : null;
    const isVisible = utcElem.classList.toggle('visible');
    if (utcLabel) utcLabel.style.display = isVisible ? '' : 'none';
    localStorage.setItem('utcVisible', isVisible ? 'true' : 'false');
    updateUtcButton();
  }
  function updateUtcButton(){
    const isVisible = Q('#utczeit').classList.contains('visible');
    const text = Q('#utcToggleBtn .btn-text');
    if (text) text.textContent = isVisible ? 'UTC Zeit aus' : 'UTC Zeit';
  }

  /* ---------- Pr√§ferenzen laden ---------- */
  function loadPreferences(){
    const stored = localStorage.getItem('darkMode');
    if (stored === 'true' || stored === 'false'){
      document.body.classList.toggle('dark', stored === 'true');
    } else {
      const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      if (prefersDark) document.body.classList.add('dark');
      else {
        const hour = new Date().getHours();
        if (hour >= 20 || hour < 6) document.body.classList.add('dark');
      }
    }

    const utcElem = Q('#utczeit');
    const utcLabel = utcElem.previousElementSibling;
    const utcVisible = localStorage.getItem('utcVisible') === 'true';
    utcElem.classList.toggle('visible', utcVisible);
    if (utcLabel) utcLabel.style.display = utcVisible ? '' : 'none';

    updateDarkModeButton();
    updateUtcButton();
  }

  // Init
  loadPreferences();
  updateTime();
  setInterval(updateTime, 1000);
  window.addEventListener('resize', () => { updateDarkModeButton(); updateUtcButton(); });

  /* ---------- PWA: Manifest & Service Worker (inline) ---------- */
  (function initPWA(){
    const manifest = {
      name: "Taktische Zeit",
      short_name: "TaktZeit",
      description: "Anzeige der taktischen Zeit (lokal & UTC) mit Dark-Mode.",
      start_url: "./",
      scope: "./",
      display: "standalone",
      background_color: "#000F75",
      theme_color: "#000F75",
      icons: [
        { src: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Crect width='512' height='512' rx='90' fill='%23000F75'/%3E%3Ctext x='50%' y='58%' font-size='260' text-anchor='middle' fill='%23B3FFFF' font-family='Arial,Helvetica,sans-serif'%3ETZ%3C/text%3E%3C/svg%3E", sizes: "512x512", type: "image/svg+xml", purpose: "any maskable" }
      ]
    };
    const manifestBlob = new Blob([JSON.stringify(manifest)], {type: 'application/json'});
    const manifestURL = URL.createObjectURL(manifestBlob);
    document.getElementById('dynamic-manifest').setAttribute('href', manifestURL);

    if ('serviceWorker' in navigator){
      const swCode = `
        const CACHE = 'taktzeit-v1';
        self.addEventListener('install', (e) => {
          e.waitUntil(
            caches.open(CACHE).then(c => c.addAll(['./']))
          );
          self.skipWaiting();
        });
        self.addEventListener('activate', (e) => {
          e.waitUntil(
            caches.keys().then(keys => Promise.all(keys.filter(k => k !== CACHE).map(k => caches.delete(k))))
          );
          self.clients.claim();
        });
        self.addEventListener('fetch', (e) => {
          const req = e.request;
          e.respondWith(
            fetch(req).then(res => {
              const copy = res.clone();
              caches.open(CACHE).then(c => c.put(req, copy)).catch(()=>{});
              return res;
            }).catch(() => caches.match(req).then(r => r || caches.match('./')))
          );
        });
      `;
      const swBlob = new Blob([swCode], {type:'text/javascript'});
      const swURL = URL.createObjectURL(swBlob);
      navigator.serviceWorker.register(swURL).catch(()=>{});
    }
  })();
</script>
</body>
</html>
